<div class="dates-container">
    <!-- En-tÃªte -->
    <div class="card header-card">
        <div class="header-actions">
            <h2 class="section-title">ğŸ“… Calculateur de Dates</h2>
            <button class="btn btn-primary" (click)="openAddForm()">
                â• Ajouter un Ã©vÃ©nement
            </button>
        </div>
        <p class="subtitle">Suivez vos Ã©vÃ©nements importants et calculez le temps Ã©coulÃ©</p>
    </div>

    <!-- Formulaire d'ajout/Ã©dition -->
    <div class="card form-card" *ngIf="showAddForm">
        <h3 class="form-title">{{ editingEvent ? 'âœï¸ Modifier l\'Ã©vÃ©nement' : 'â• Nouvel Ã©vÃ©nement' }}</h3>

        <form (ngSubmit)="saveEvent()">
            <div class="form-group">
                <label class="label">Titre de l'Ã©vÃ©nement</label>
                <input
                    #titleInput
                    type="text"
                    class="input"
                    [(ngModel)]="formData.title"
                    name="title"
                    placeholder="Ex: Notre rencontre, DÃ©mÃ©nagement..."
                    required>
            </div>

            <div class="form-group">
                <label class="label">PÃ©riode 1 - Date de dÃ©but</label>
                <input
                        type="date"
                        class="input"
                        [(ngModel)]="formData.period1Start"
                        name="period1Start"
                        [max]="getTodayDate()"
                        required>
            </div>

            <div class="form-group toggle-group">
                <label class="toggle">
                    <input
                            type="checkbox"
                            [(ngModel)]="formData.useTwoPeriods"
                            name="useTwoPeriods"
                            (change)="onToggleChange()">
                    <span class="toggle-slider"></span>
                </label>
                <label class="toggle-label">Calculer sur 2 pÃ©riodes distinctes</label>
            </div>

            <div *ngIf="formData.useTwoPeriods">
                <div class="form-group">
                    <label class="label">PÃ©riode 1 - Date de fin</label>
                    <input
                            type="date"
                            class="input"
                            [(ngModel)]="formData.period1End"
                            name="period1End"
                            [min]="formData.period1Start"
                            [max]="getTodayDate()"
                            [required]="formData.useTwoPeriods">
                </div>

                <div class="form-group">
                    <label class="label">PÃ©riode 2 - Date de dÃ©but (jusqu'Ã  aujourd'hui)</label>
                    <input
                            type="date"
                            class="input"
                            [(ngModel)]="formData.period2Start"
                            name="period2Start"
                            [min]="formData.period1End"
                            [max]="getTodayDate()"
                            [required]="formData.useTwoPeriods">
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    {{ editingEvent ? 'ğŸ’¾ Modifier' : 'â• Ajouter' }}
                </button>
                <button type="button" class="btn btn-secondary" (click)="closeForm()">
                    âŒ Annuler
                </button>
            </div>
        </form>
    </div>

    <!-- Liste des Ã©vÃ©nements en cartes -->
    <div class="events-grid" *ngIf="events.length > 0">
        <div
                *ngFor="let event of events; let i = index"
                class="event-card"
                [style.background]="getEventColor(i)">

            <div class="event-content">
                <div class="event-header">
                    <h3 class="event-title">{{ event.title }}</h3>
                    <div class="event-actions">
                        <button class="icon-btn-white" (click)="openEditForm(event)" title="Modifier">
                            âœï¸
                        </button>
                        <button class="icon-btn-white" (click)="deleteEvent(event)" title="Supprimer">
                            ğŸ—‘ï¸
                        </button>
                    </div>
                </div>

                <div class="event-date-info">
                    <div class="date-badge" *ngIf="!event.useTwoPeriods">
                        ğŸ“… {{ formatDate(event.period1Start) }} â†’ Aujourd'hui
                    </div>
                    <div class="date-badge" *ngIf="event.useTwoPeriods">
                        ğŸ“… PÃ©riode 1: {{ formatDate(event.period1Start) }} â†’ {{ formatDate(event.period1End!) }}<br>
                        ğŸ“… PÃ©riode 2: {{ formatDate(event.period2Start!) }} â†’ Aujourd'hui
                    </div>
                </div>

                <div class="calculation-display">
                    <ng-container *ngIf="calculateDate(event) as calc">
                        <div class="calc-row">
                            <div class="calc-item">
                                <div class="calc-value">{{ calc.years }}</div>
                                <div class="calc-label">{{ calc.years > 1 ? 'ans' : 'an' }}</div>
                            </div>
                            <div class="calc-separator">Â·</div>
                            <div class="calc-item">
                                <div class="calc-value">{{ calc.months }}</div>
                                <div class="calc-label">mois</div>
                            </div>
                            <div class="calc-separator">Â·</div>
                            <div class="calc-item">
                                <div class="calc-value">{{ calc.days }}</div>
                                <div class="calc-label">{{ calc.days > 1 ? 'jours' : 'jour' }}</div>
                            </div>
                        </div>
                        <div class="total-days">
                            <strong>{{ calc.totalDays }}</strong> {{ calc.totalDays > 1 ? 'jours' : 'jour' }} au total
                        </div>
                    </ng-container>
                </div>
                <!-- Prochain anniversaire -->
                <ng-container *ngIf="getNextAnniversary(event) as anniversary">
                    <div class="anniversary-info">
                        <div class="anniversary-icon">ğŸ‚</div>
                        <div class="anniversary-content">
                            <div class="anniversary-label">
                                {{ event.useTwoPeriods ? 'Prochaine annÃ©e pleine' : 'Prochain anniversaire' }}
                            </div>
                            <div class="anniversary-date">{{ anniversary.text }}</div>
                            <div class="anniversary-countdown" *ngIf="anniversary.daysUntil === 0">
                                ğŸ‰ C'est aujourd'hui !
                            </div>
                            <div class="anniversary-countdown" *ngIf="anniversary.daysUntil === 1">
                                â° Demain !
                            </div>
                            <div class="anniversary-countdown" *ngIf="anniversary.daysUntil > 1">
                                ğŸ“… Dans {{ anniversary.daysUntil }} jours
                            </div>
                        </div>
                    </div>
                </ng-container>
            </div>
        </div>
    </div>

    <!-- Ã‰tat vide -->
    <div class="card empty-state" *ngIf="events.length === 0">
        <div class="empty-icon">ğŸ“…</div>
        <h3>Aucun Ã©vÃ©nement enregistrÃ©</h3>
        <p>Commencez par ajouter votre premier Ã©vÃ©nement pour suivre le temps Ã©coulÃ©</p>
        <button class="btn btn-primary" (click)="openAddForm()" style="margin-top: 1rem;">
            â• Ajouter un Ã©vÃ©nement
        </button>
    </div>

    <!-- Info -->
    <div class="card info-card" *ngIf="events.length > 0">
        <div class="info-content">
            <span class="info-icon">ğŸ’¡</span>
            <div>
                <strong>Astuce :</strong> Activez le toggle "2 pÃ©riodes" pour calculer deux pÃ©riodes sÃ©parÃ©es.
                Par exemple : pÃ©riode 1 (janvier 2011 â†’ novembre 2011) + pÃ©riode 2 (janvier 2016 â†’ aujourd'hui).
                Le total affichÃ© cumule les deux pÃ©riodes.
            </div>
        </div>
    </div>
</div>