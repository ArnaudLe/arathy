<div class="dates-container">
    <!-- En-t√™te -->
    <div class="card header-card">
        <div class="header-actions">
            <h2 class="section-title">üìÖ Calculateur de Dates</h2>
            <button class="btn btn-primary" (click)="openAddForm()">
                ‚ûï Ajouter un √©v√©nement
            </button>
        </div>
        <p class="subtitle">Suivez vos √©v√©nements importants et calculez le temps √©coul√©</p>
    </div>

    <!-- Formulaire d'ajout/√©dition -->
    <div class="card form-card" *ngIf="showAddForm">
        <h3 class="form-title">{{ editingEvent ? '‚úèÔ∏è Modifier l\'√©v√©nement' : '‚ûï Nouvel √©v√©nement' }}</h3>

        <form (ngSubmit)="saveEvent()">
            <div class="form-group">
                <label class="label">Titre de l'√©v√©nement</label>
                <input
                        type="text"
                        class="input"
                        [(ngModel)]="formData.title"
                        name="title"
                        placeholder="Ex: Notre rencontre, D√©m√©nagement..."
                        required>
            </div>

            <div class="form-group">
                <label class="label">P√©riode 1 - Date de d√©but</label>
                <input
                        type="date"
                        class="input"
                        [(ngModel)]="formData.period1Start"
                        name="period1Start"
                        [max]="getTodayDate()"
                        required>
            </div>

            <div class="form-group toggle-group">
                <label class="toggle">
                    <input
                            type="checkbox"
                            [(ngModel)]="formData.useTwoPeriods"
                            name="useTwoPeriods"
                            (change)="onToggleChange()">
                    <span class="toggle-slider"></span>
                </label>
                <label class="toggle-label">Calculer sur 2 p√©riodes distinctes</label>
            </div>

            <div *ngIf="formData.useTwoPeriods">
                <div class="form-group">
                    <label class="label">P√©riode 1 - Date de fin</label>
                    <input
                            type="date"
                            class="input"
                            [(ngModel)]="formData.period1End"
                            name="period1End"
                            [min]="formData.period1Start"
                            [max]="getTodayDate()"
                            [required]="formData.useTwoPeriods">
                </div>

                <div class="form-group">
                    <label class="label">P√©riode 2 - Date de d√©but (jusqu'√† aujourd'hui)</label>
                    <input
                            type="date"
                            class="input"
                            [(ngModel)]="formData.period2Start"
                            name="period2Start"
                            [min]="formData.period1End"
                            [max]="getTodayDate()"
                            [required]="formData.useTwoPeriods">
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    {{ editingEvent ? 'üíæ Modifier' : '‚ûï Ajouter' }}
                </button>
                <button type="button" class="btn btn-secondary" (click)="closeForm()">
                    ‚ùå Annuler
                </button>
            </div>
        </form>
    </div>

    <!-- Liste des √©v√©nements en cartes -->
    <div class="events-grid" *ngIf="events.length > 0">
        <div
                *ngFor="let event of events; let i = index"
                class="event-card"
                [style.background]="getEventColor(i)">

            <div class="event-content">
                <div class="event-header">
                    <h3 class="event-title">{{ event.title }}</h3>
                    <div class="event-actions">
                        <button class="icon-btn-white" (click)="openEditForm(event)" title="Modifier">
                            ‚úèÔ∏è
                        </button>
                        <button class="icon-btn-white" (click)="deleteEvent(event)" title="Supprimer">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>

                <div class="event-date-info">
                    <div class="date-badge" *ngIf="!event.useTwoPeriods">
                        üìÖ {{ formatDate(event.period1Start) }} ‚Üí Aujourd'hui
                    </div>
                    <div class="date-badge" *ngIf="event.useTwoPeriods">
                        üìÖ P√©riode 1: {{ formatDate(event.period1Start) }} ‚Üí {{ formatDate(event.period1End!) }}<br>
                        üìÖ P√©riode 2: {{ formatDate(event.period2Start!) }} ‚Üí Aujourd'hui
                    </div>
                </div>

                <div class="calculation-display">
                    <ng-container *ngIf="calculateDate(event) as calc">
                        <div class="calc-row">
                            <div class="calc-item">
                                <div class="calc-value">{{ calc.years }}</div>
                                <div class="calc-label">{{ calc.years > 1 ? 'ans' : 'an' }}</div>
                            </div>
                            <div class="calc-separator">¬∑</div>
                            <div class="calc-item">
                                <div class="calc-value">{{ calc.months }}</div>
                                <div class="calc-label">mois</div>
                            </div>
                            <div class="calc-separator">¬∑</div>
                            <div class="calc-item">
                                <div class="calc-value">{{ calc.days }}</div>
                                <div class="calc-label">{{ calc.days > 1 ? 'jours' : 'jour' }}</div>
                            </div>
                        </div>
                        <div class="total-days">
                            <strong>{{ calc.totalDays }}</strong> {{ calc.totalDays > 1 ? 'jours' : 'jour' }} au total
                        </div>
                    </ng-container>
                </div>
            </div>
        </div>
    </div>

    <!-- √âtat vide -->
    <div class="card empty-state" *ngIf="events.length === 0">
        <div class="empty-icon">üìÖ</div>
        <h3>Aucun √©v√©nement enregistr√©</h3>
        <p>Commencez par ajouter votre premier √©v√©nement pour suivre le temps √©coul√©</p>
        <button class="btn btn-primary" (click)="openAddForm()" style="margin-top: 1rem;">
            ‚ûï Ajouter un √©v√©nement
        </button>
    </div>

    <!-- Info -->
    <div class="card info-card" *ngIf="events.length > 0">
        <div class="info-content">
            <span class="info-icon">üí°</span>
            <div>
                <strong>Astuce :</strong> Activez le toggle "2 p√©riodes" pour calculer deux p√©riodes s√©par√©es.
                Par exemple : p√©riode 1 (janvier 2011 ‚Üí novembre 2011) + p√©riode 2 (janvier 2016 ‚Üí aujourd'hui).
                Le total affich√© cumule les deux p√©riodes.
            </div>
        </div>
    </div>
</div>